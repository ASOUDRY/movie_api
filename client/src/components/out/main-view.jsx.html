<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <title>JSDoc: Source: main-view.jsx</title>

    <script src="scripts/prettify/prettify.js"> </script>
    <script src="scripts/prettify/lang-css.js"> </script>
    <!--[if lt IE 9]>
      <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
    <link type="text/css" rel="stylesheet" href="styles/prettify-tomorrow.css">
    <link type="text/css" rel="stylesheet" href="styles/jsdoc-default.css">
</head>

<body>

<div id="main">

    <h1 class="page-title">Source: main-view.jsx</h1>

    



    
    <section>
        <article>
            <pre class="prettyprint source linenums"><code>import React from 'react';
import axios from 'axios';
import { BrowserRouter as Router, Route, Redirect, NavLink } from "react-router-dom";
import Nav from 'react-bootstrap/Nav'
import { LoginView } from '../login-view/login-view';
import { Register } from '../register/register';
import { MovieView } from '../movie-view/movie-view';
import { ProfileView } from '../profile/profile-view.jsx';
import  { GenreView}  from '../genre-view/genre-view.jsx';
import { GenreMovie } from '../genre-view/genre-card.jsx';
import { DirectorView } from '../director-components/director-view.jsx'
import { DirectorCard} from '../director-components/director-card.jsx'
import MoviesList from '../movies-list/movies-list';
import './main-view.css';


import { connect } from 'react-redux';

import { setMovies, setUser, setDirectors, setGenres } from '../../actions/actions'

export class MainView extends React.Component {
    constructor() {
      super();
  
      this.state = {
        user: null,
        directors: [],
        genres: [],
        genreMovie: [],
        directorMovie: [],
        loggedIn: false
      };
    }

    componentDidMount() {
      let accessToken = localStorage.getItem('token');
      if (accessToken !== null) {
        this.setState({
          user: localStorage.getItem('user'),
          loggedIn: true
        });
        this.props.setUser(localStorage.getItem('user'));
        this.getMovies(accessToken);
        this.getGenres(accessToken);
        this.getDirectors(accessToken);  
        this.getGenres(accessToken);
      }
    }


// Prop for logging in

    /**
     * @function onLoggeded
     * @param {object} data data passed from LoginView
     * @returns {function} one of three functions, being getMovies, getDirectors, or getGenres
     */
    onLoggedIn(data) {
      console.log(data);
      const username = data.user.Username;
      this.props.setUser(username)
        this.setState({
          user: data.user.Username,
          loggedIn: true,
        }, () => {
          console.log(this.state.loggedIn)
        });
        localStorage.setItem('token', data.token);
        localStorage.setItem('user', username);
  
        this.getMovies(data.token); 
        this.getDirectors(data.token);
        this.getGenres(data.token);
    }

// Updates the local user host
    update(username) {
      console.log(username + " is the username here!");
      this.props.setUser(username)
      localStorage.removeItem("user")
      localStorage.setItem('user', username);
    }


// Fetching the data for  the movies
    getMovies(token) {
      axios.get('https://moviecat0l0gue.herokuapp.com/movies', {
        headers: { Authorization: `Bearer ${token}`}
      })
        .then(response => {
          this.props.setMovies(response.data);
      })
        .catch(function (error) {
          console.log(error);
      });
    }
    
    getGenres(token) {
      axios.get('https://moviecat0l0gue.herokuapp.com/genres', {
        headers: { Authorization: `Bearer ${token}`}
      })
      .then(response => {
      this.setState({
        genres: response.data
      })
      })
        .catch(function (error) {
          console.log(error);
      });
    }

    getDirectors(token) {
      axios.get('https://moviecat0l0gue.herokuapp.com/directors', {
        headers: { Authorization: `Bearer ${token}`}
      })
      .then(response => {
        this.setState({
          directors: response.data
        })
       
      })
        .catch(function (error) {
          console.log(error);
      });
    }

   
// Props for filtering out genre and director
    genreProp(genreName) {
      let token = localStorage.getItem('token');
      axios.get(`https://moviecat0l0gue.herokuapp.com/genres/${genreName}`, {
        headers: { Authorization: `Bearer ${token}`}
      })
      .then(response => {
        console.log(response.data);
        this.setState({
          genreMovie: response.data
        })
      })}

      // Unrelated to Director View. Safe to ignore.
    directorProp(directorTag) {
        let token = localStorage.getItem('token');
        axios.get(`https://moviecat0l0gue.herokuapp.com/directors/${directorTag}`, {
          headers: { Authorization: `Bearer ${token}`}
        })
        .then(response => {
          console.log(response.data);
          this.setState({
            directorMovie: response.data
          })
        })}
    
    render() {
// console.log(this.state.directorMovie);
    let { movies } = this.props;
    let { user } = this.state;

    const { directors, genres, genreMovie, directorMovie, loggedIn } = this.state;

    const url = localStorage.getItem('user');
    return (
      
      &lt;div className="SuperDiv">
      
      &lt;Nav className="justify-content-end" >
        &lt;Nav.Item>
        &lt;Nav.Link href="/client/movies" >Movies&lt;/Nav.Link>       
          &lt;/Nav.Item>
          &lt;Nav.Item>
            &lt;Nav.Link href="/client/Directors">Directors&lt;/Nav.Link>
          &lt;/Nav.Item>
          &lt;Nav.Item>
            &lt;Nav.Link href="/client/Genres">Genres&lt;/Nav.Link>
          &lt;/Nav.Item>
          &lt;Nav.Item> 
            &lt;Nav.Link href="/client/Profile">Profile&lt;/Nav.Link>
          &lt;/Nav.Item>
        &lt;/Nav>
      
      &lt;Router basename="/client">
      &lt;Route exact path="/"> {(!user) ? &lt;Redirect to="/login" /> : &lt;Redirect to="/movies"/>}&lt;/Route>
        &lt;Route path="/login" render={() => { return &lt;LoginView onLoggedIn={data => this.onLoggedIn(data)} /> }} />
        &lt;Route path="/movies" render={() => {return &lt;MoviesList movies={movies}/>}} />
        &lt;Route path="/Genres" render={() => { return genres.map(g => &lt;GenreView genreProp={genreName => this.genreProp(genreName)} key={g._id} genres={g}/>);}}/>
        &lt;Route exact path="/Directors" render={() => { return directors.map(d => &lt;DirectorView directorProp={directorTag => this.directorProp(directorTag)} key={d._id} directors={d}/>) }}/>
        &lt;Route exact path="/Director/:Director" render={() => { return directorMovie.map(dm => &lt;DirectorCard key={dm._id} directorMovie={dm}/>) }}/>
        &lt;Route exact path="/Genre/:Genre" render={() => { return genreMovie.map(gm => &lt;GenreMovie key={gm._id}  genreMovie={gm}/>)}}/>
        &lt;Route exact path="/singlemovie/:movieId" render={({match}) => &lt;MovieView movie={movies.find(m => m._id === match.params.movieId)}/>}/>
        &lt;Route exact path="/singlemovie/:movieTitle/Favorite" render={({match}) => &lt;MovieView movie={movies.find(m => m.Title === match.params.movieTitle)}/>}/>
        &lt;Route path="/Register" render={() => {return &lt;Register/>;}}/>      
        &lt;Route path= "/Profile" render={ () => { return &lt;ProfileView update={ (username) => this.update(username)} /> }}/>
      &lt;/Router>     
      &lt;/div>
    );
  }
}
let mapStateToProps = state => {
  return { movies: state.movies,
           users: state.users,
           genres: state.genres,
           directors: state.directors }
}
// added setDirectors
export default connect(mapStateToProps, { setMovies, setUser, setDirectors, setGenres } )(MainView);</code></pre>
        </article>
    </section>




</div>

<nav>
    <h2><a href="index.html">Home</a></h2><h3>Global</h3><ul><li><a href="global.html#onLoggeded">onLoggeded</a></li></ul>
</nav>

<br class="clear">

<footer>
    Documentation generated by <a href="https://github.com/jsdoc/jsdoc">JSDoc 3.6.7</a> on Wed Sep 08 2021 23:27:49 GMT-0400 (Eastern Daylight Time)
</footer>

<script> prettyPrint(); </script>
<script src="scripts/linenumber.js"> </script>
</body>
</html>
