<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <title>JSDoc: Source: profile-view.jsx</title>

    <script src="scripts/prettify/prettify.js"> </script>
    <script src="scripts/prettify/lang-css.js"> </script>
    <!--[if lt IE 9]>
      <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
    <link type="text/css" rel="stylesheet" href="styles/prettify-tomorrow.css">
    <link type="text/css" rel="stylesheet" href="styles/jsdoc-default.css">
</head>

<body>

<div id="main">

    <h1 class="page-title">Source: profile-view.jsx</h1>

    



    
    <section>
        <article>
            <pre class="prettyprint source linenums"><code>import React from 'react';
import axios from 'axios';
import { FavMovieCard } from '../profile/favorite.jsx';
import './profile-view.css';
import { Modal, Button, Card, Form } from 'react-bootstrap/'

export class ProfileView extends React.Component {
    constructor(props) {
       super(props)

      this.Username = "",
      this.Password = "",
      this.Email = "",
      this.Birthday = "",
      this.Movie = ""

      this.state = {
        info : [],
        favorite: [],
        show: false
      };

    }

    componentDidMount() {
      let accessToken = localStorage.getItem('token');
      this.getFavorites(accessToken);
    }
   /**
    * Fetches movies from the personal users endpoint.
    * @function getFavorites
    * @param {string} token 
    * @returns {void}
    */
    getFavorites(token) {
      const user = localStorage.getItem('user');
      axios.get(`https://moviecat0l0gue.herokuapp.com/users/${user}`, {
                headers: { Authorization: `Bearer ${token}`}
          })
              .then((response) => {
                this.setState({
                  info: response.data[0],
                  favorite: response.data[0].FavoriteMovies
        })
     })
    }

    setUsername(input) {
        this.Username = input;
    }
    
    setPassword(input) {
        this.Password = input;
    }
    
    setEmail(input) {
        this.Email = input;
    }
    
    setBirthday(input) {
        this.Birthday = input;
    }

    setMovie(input) {
      this.Movie = input;
    }

    /**
     * Updates the user point, and calls the update function
     * @function profileUpdate
     * @returns {function} this.props.update(username)
     */
    profileUpdate() {
        const user = localStorage.getItem('user');
        const token = localStorage.getItem('token');
        axios.put(`https://moviecat0l0gue.herokuapp.com/users/${user}`, {
          Username: this.Username,
          Password: this.Password,
          Email: this.Email,
          Birthday: this.Birthday
      }, {
          headers: { Authorization: `Bearer ${token}`}
        })
        .then((response) => {
          console.log(response)
          const username = response.data.Username
          console.log(username);
          this.props.update(username)
        })
        .catch(error => {
          console.log(error);
        })}

    handleModal(e) {
      // e.preventDefault();
     this.setState({show: true})
      console.log(this.state.show)
    }

    close() {
      this.setState({show:false})
    }

    logOut() {
          window.localStorage.removeItem("token");
          window.localStorage.removeItem("user");
          window.open('/client/login', '_self')
    }
    
   
    /**
     * fetches favorite data from favorite endpoint, and uses it post another endpoint.
     * @function AddMe
     * @returns {void}
     */
    AddMe() {
          let favorite = this.Movie;
          const token = localStorage.getItem('token');
          axios.get(`https://moviecat0l0gue.herokuapp.com/movies/${favorite}`, 
          { headers: { Authorization: `Bearer ${token}`}
        })
          .then((response) => {
          const user = localStorage.getItem('user')
          const Title = response.data.Title;
          const Id = response.data._id;
          const Image = response.data.FavImage
          axios.post(`https://moviecat0l0gue.herokuapp.com/${user}/${Title}/${Id}/${Image}`, {}, {headers: {Authorization: `Bearer ${token}`}})
          .then(() => {
              this.getFavorites(token);
            })
            .catch(error => {
              console.log(error);
            })
          })
    }
    
    RemoveMe (removeable) {
      console.log("You have been clicked!")
          const token = localStorage.getItem('token');
          axios.get(`https://moviecat0l0gue.herokuapp.com/movies/${removeable}`, {
            headers: { Authorization: `Bearer ${token}`}
          })
          .then((response) => {
            const user = localStorage.getItem('user')
            const Title = response.data.Title;
            const Id = response.data._id;
            const Image = response.data.FavImage
            console.log(token);
            axios.post(`https://moviecat0l0gue.herokuapp.com/${user}/${Title}/${Id}/${Image}/Remove`, {}, {
              headers: { Authorization: `Bearer ${token}`}
            })
            .then(() => {
              this.getFavorites(token);
            })
            .catch(error => {
              console.log(error);
            })
          })
    }
        
    DeleteAccount ()  {
          const token = localStorage.getItem('token');
          const user = localStorage.getItem('user')
          axios.delete(`https://moviecat0l0gue.herokuapp.com/users/${user}`, {
            headers: { Authorization: `Bearer ${token}`}
          })
          .then(() => {
            console.log("bye Felicia");
            window.localStorage.removeItem("token");
            window.localStorage.removeItem("user");
            window.open('/client', '_self')
          })
          .catch(error => {
            console.log(error)
          })
    }

render() {
  const { favorite, info } = this.state;
  const user = localStorage.getItem('user')
    return (
      &lt;div>
        &lt;Card className="w-40 ml-2 pr-4 pb-4">
            &lt;Card.Body> 
            &lt;Button className="But" onClick={() => this.handleModal()}>Edit your Account.&lt;/Button>
            &lt;h5>Username:&lt;/h5>
            &lt;h6>{user}&lt;/h6>
            &lt;h5>Email:&lt;/h5>
            &lt;h6>{info.Email}&lt;/h6>
            &lt;div className="But" >
            &lt;Button variant="primary" onClick={() => this.logOut()}> Log Out! &lt;/Button>
            &lt;Button   variant="secondary"  onClick={() => this.DeleteAccount()}> Delete Account &lt;/Button>
            &lt;/div>
            &lt;/Card.Body>
          &lt;/Card>
         
         &lt;Modal show={this.state.show} onHide={() => this.close()} >
           &lt;Modal.Body>
            &lt;Form>
           &lt;Form.Label> Update your account Information&lt;/Form.Label>
               &lt;Form.Group>
                 &lt;Form.Label>Username&lt;/Form.Label>
                 &lt;Form.Control type="text" placeholder="Enter new Username"  onChange={e => this.setUsername(e.target.value)} />
               &lt;/Form.Group>
               &lt;Form.Group>
                 &lt;Form.Label>Password&lt;/Form.Label>
                 &lt;Form.Control type="Password" placeholder="Enter new Password"  onChange={e => this.setPassword(e.target.value)} />
               &lt;/Form.Group>
               &lt;Form.Group>
                 &lt;Form.Label>Email address&lt;/Form.Label>
                 &lt;Form.Control type="email" placeholder="Enter email"  onChange={e => this.setEmail(e.target.value)} />
               &lt;/Form.Group>
               &lt;Form.Group>
                 &lt;Form.Label>Birthday&lt;/Form.Label>
                 &lt;Form.Control type="Date" placeholder="Enter your date" onChange={e => this.setBirthday(e.target.value)} />
               &lt;/Form.Group>
               &lt;Form.Group>
               &lt;/Form.Group>
               &lt;Button variant="primary" onClick={() => this.profileUpdate(this.Username, this.Password, this.Email, this.Birthday)}> Update &lt;/Button>  
             &lt;/Form>
           &lt;/Modal.Body>
           &lt;Modal.Footer>
             &lt;Button onClick={() => this.close()} >Close&lt;/Button>
           &lt;/Modal.Footer>
         &lt;/Modal>
      &lt;div className="top">
     
      &lt;div className="form">
      {/* &lt;h5 >Favorite Movies&lt;/h5> */}
      &lt;Form.Control className="w-90" type="text" placeholder="Enter the name of your favorite Movie here." onChange={e => this.setMovie(e.target.value)} />
      &lt;Button variant="primary" onClick={() => this.AddMe(this.Movie)}> Add &lt;/Button>   
      &lt;/div>   
      &lt;/div>
        
      &lt;div className="cardo">{
            favorite.map(input => &lt;FavMovieCard RemoveMe={removeable => this.RemoveMe(removeable)} key={input.Id} favorite={input} />)
            }   
      &lt;/div> 
      &lt;/div>         
    )
  }
}</code></pre>
        </article>
    </section>




</div>

<nav>
    <h2><a href="index.html">Home</a></h2><h3>Global</h3><ul><li><a href="global.html#AddMe">AddMe</a></li><li><a href="global.html#getFavorites">getFavorites</a></li><li><a href="global.html#profileUpdate">profileUpdate</a></li></ul>
</nav>

<br class="clear">

<footer>
    Documentation generated by <a href="https://github.com/jsdoc/jsdoc">JSDoc 3.6.7</a> on Thu Sep 09 2021 00:28:08 GMT-0400 (Eastern Daylight Time)
</footer>

<script> prettyPrint(); </script>
<script src="scripts/linenumber.js"> </script>
</body>
</html>
